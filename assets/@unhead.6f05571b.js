import{c as M}from"./hookable.9d32b690.js";import{n as L,g as S,i as U,r as K,w as W,a as F,o as N,u as k,b as B,v as q}from"./@vue.f5112019.js";const V=["script","style","noscript"],J=["base","meta","link","style","script","noscript"],Q=["base","title","titleTemplate","bodyAttrs","htmlAttrs"];function z(e,n){const{props:t,tag:r}=e;if(Q.includes(r))return r;if(r==="link"&&t.rel==="canonical")return"canonical";if(t.charset)return"charset";const s=["id"];r==="meta"&&s.push("name","property","http-equiv");for(const i of s)if(typeof t[i]<"u"){const c=String(t[i]);return n&&!n(c)?!1:`${r}:${i}:${c}`}return!1}const $=(e,n)=>{const{tag:t,$el:r}=e;!r||(Object.entries(t.props).forEach(([s,i])=>{i=String(i);const c=`attr:${s}`;if(s==="class"){if(!i)return;for(const l of i.split(" ")){const f=`${c}:${l}`;n&&n(e,f,()=>r.classList.remove(l)),r.classList.contains(l)||r.classList.add(l)}return}n&&!s.startsWith("data-h-")&&n(e,c,()=>r.removeAttribute(s)),r.getAttribute(s)!==i&&r.setAttribute(s,i)}),V.includes(t.tag)&&r.innerHTML!==(t.children||"")&&(r.innerHTML=t.children||""))};function A(e){let n=9;for(let t=0;t<e.length;)n=Math.imul(n^e.charCodeAt(t++),9**9);return((n^n>>>9)+65536).toString(16).substring(1,8).toLowerCase()}async function I(e,n={}){var p,y;const t={shouldRender:!0};if(await e.hooks.callHook("dom:beforeRender",t),!t.shouldRender)return;const r=n.document||window.document,s=e._popSideEffectQueue();e.headEntries().map(d=>d._sde).forEach(d=>{Object.entries(d).forEach(([o,a])=>{s[o]=a})});const i=async d=>{const o=e.headEntries().find(g=>g._i===d._e),a={renderId:d._d||A(JSON.stringify({...d,_e:void 0,_p:void 0})),$el:null,shouldRender:!0,tag:d,entry:o,staleSideEffects:s};return await e.hooks.callHook("dom:beforeRenderTag",a),a},c=[],l={body:[],head:[]},f=(d,o,a)=>{o=`${d.renderId}:${o}`,d.entry&&(d.entry._sde[o]=a),delete s[o]},u=d=>{e._elMap[d.renderId]=d.$el,c.push(d),f(d,"el",()=>{var o;(o=d.$el)==null||o.remove(),delete e._elMap[d.renderId]})};for(const d of await e.resolveTags()){const o=await i(d);if(!o.shouldRender)continue;const{tag:a}=o;if(a.tag==="title"){r.title=a.children||"",c.push(o);continue}if(a.tag==="htmlAttrs"||a.tag==="bodyAttrs"){o.$el=r[a.tag==="htmlAttrs"?"documentElement":"body"],$(o,f),c.push(o);continue}if(o.$el=e._elMap[o.renderId],!o.$el&&a._hash&&(o.$el=r.querySelector(`${(p=a.tagPosition)!=null&&p.startsWith("body")?"body":"head"} > ${a.tag}[data-h-${a._hash}]`)),o.$el){o.tag._d&&$(o),u(o);continue}o.$el=r.createElement(a.tag),$(o),l[(y=a.tagPosition)!=null&&y.startsWith("body")?"body":"head"].push(o)}Object.entries(l).forEach(([d,o])=>{if(!!o.length){for(const a of[...r[d].children].reverse()){const g=a.tagName.toLowerCase();if(!J.includes(g))continue;const w=z({tag:g,props:a.getAttributeNames().reduce((h,b)=>({...h,[b]:a.getAttribute(b)}),{})}),m=o.findIndex(h=>h&&(h.tag._d===w||a.isEqualNode(h.$el)));if(m!==-1){const h=o[m];h.$el=a,$(h),u(h),delete o[m]}}o.forEach(a=>{if(!!a.$el){switch(a.tag.tagPosition){case"bodyClose":r.body.appendChild(a.$el);break;case"bodyOpen":r.body.insertBefore(a.$el,r.body.firstChild);break;case"head":default:r.head.appendChild(a.$el);break}u(a)}})}});for(const d of c)await e.hooks.callHook("dom:renderTag",d);Object.values(s).forEach(d=>d())}let v=null;async function G(e,n={}){function t(){return v=null,I(e,n)}const r=n.delayFn||(s=>setTimeout(s,10));return v=v||new Promise(s=>r(()=>s(t())))}const X={__proto__:null,debouncedRenderDOMHead:G,get domUpdatePromise(){return v},hashCode:A,renderDOMHead:I},Y=["title","titleTemplate","base","htmlAttrs","bodyAttrs","meta","link","style","script","noscript"],Z=["tagPosition","tagPriority","tagDuplicateStrategy"];async function x(e,n){const t={tag:e,props:{}};return e==="title"||e==="titleTemplate"?(t.children=n instanceof Promise?await n:n,t):(t.props=await ee({...n}),["children","innerHtml","innerHTML"].forEach(r=>{typeof t.props[r]<"u"&&(t.children=t.props[r],typeof t.children=="object"&&(t.children=JSON.stringify(t.children)),delete t.props[r])}),Object.keys(t.props).filter(r=>Z.includes(r)).forEach(r=>{t[r]=t.props[r],delete t.props[r]}),typeof t.props.class=="object"&&!Array.isArray(t.props.class)&&(t.props.class=Object.keys(t.props.class).filter(r=>t.props.class[r])),Array.isArray(t.props.class)&&(t.props.class=t.props.class.join(" ")),t.props.content&&Array.isArray(t.props.content)?t.props.content.map((r,s)=>{const i={...t,props:{...t.props}};return i.props.content=r,i.key=`${t.props.name||t.props.property}:${s}`,i}):t)}async function ee(e){for(const n of Object.keys(e))e[n]instanceof Promise&&(e[n]=await e[n]),String(e[n])==="true"?e[n]="":String(e[n])==="false"&&delete e[n];return e}const O=e=>{if(typeof e.tagPriority=="number")return e.tagPriority;switch(e.tagPriority){case"critical":return 2;case"high":return 9;case"low":return 12}switch(e.tag){case"base":return-1;case"title":return 1;case"meta":return e.props.charset?-2:e.props["http-equiv"]==="content-security-policy"?0:10;default:return 10}},te=(e,n)=>O(e)-O(n),re=["base","title","titleTemplate","bodyAttrs","htmlAttrs"];function ne(e,n){const{props:t,tag:r}=e;if(re.includes(r))return r;if(r==="link"&&t.rel==="canonical")return"canonical";if(t.charset)return"charset";const s=["id"];r==="meta"&&s.push("name","property","http-equiv");for(const i of s)if(typeof t[i]<"u"){const c=String(t[i]);return n&&!n(c)?!1:`${r}:${i}:${c}`}return!1}const C=(e,n)=>e==null?n||null:typeof e=="function"?e(n):e.replace("%s",n!=null?n:"");function se(e){let n=e.findIndex(r=>r.tag==="titleTemplate");const t=e.findIndex(r=>r.tag==="title");if(t!==-1&&n!==-1){const r=C(e[n].children,e[t].children);r!==null?e[t].children=r||e[t].children:delete e[t]}else if(n!==-1){const r=C(e[n].children);r!==null&&(e[n].children=r,e[n].tag="title",n=-1)}return n!==-1&&delete e[n],e.filter(Boolean)}const oe=e=>{e=e||{};const n=e.dedupeKeys||["hid","vmid","key"];return{hooks:{"tag:normalise":function({tag:t}){n.forEach(s=>{t.props[s]&&(t.key=t.props[s],delete t.props[s])});const r=t.key?`${t.tag}:${t.key}`:ne(t);r&&(t._d=r)},"tags:resolve":function(t){const r={};t.tags.forEach(s=>{let i=s._d||s._p;const c=r[i];if(c){let l=s==null?void 0:s.tagDuplicateStrategy;if(!l&&(s.tag==="htmlAttrs"||s.tag==="bodyAttrs")&&(l="merge"),l==="merge"){const u=c.props;["class","style"].forEach(p=>{s.props[p]&&u[p]&&(p==="style"&&!u[p].endsWith(";")&&(u[p]+=";"),s.props[p]=`${u[p]} ${s.props[p]}`)}),r[i].props={...u,...s.props};return}else s._e===c._e&&(i=s._d=`${i}:${s._p}`);const f=Object.keys(s.props).length;if((f===0||f===1&&typeof s.props["data-h-key"]<"u")&&!s.children){delete r[i];return}}r[i]=s}),t.tags=Object.values(r)}}}},ie=()=>({hooks:{"tags:resolve":e=>{const n=t=>{var r;return(r=e.tags.find(s=>s._d===t))==null?void 0:r._p};for(const t of e.tags){if(!t.tagPriority||typeof t.tagPriority=="number")continue;const r=[{prefix:"before:",offset:-1},{prefix:"after:",offset:1}];for(const{prefix:s,offset:i}of r)if(t.tagPriority.startsWith(s)){const c=t.tagPriority.replace(s,""),l=n(c);typeof l<"u"&&(t._p=l+i)}}e.tags.sort((t,r)=>t._p-r._p).sort(te)}}}),ae=()=>({hooks:{"tags:resolve":e=>{e.tags=se(e.tags)}}}),de=()=>({hooks:{"tag:normalise":function({tag:e}){typeof e.props.body<"u"&&(e.tagPosition="bodyClose",delete e.props.body)}}}),ce=typeof window<"u",le=()=>({hooks:{"tag:normalise":e=>{var s,i;const{tag:n,entry:t}=e,r=typeof n.props._dynamic<"u";!j.includes(n.tag)||!n.key||(n._hash=A(JSON.stringify({tag:n.tag,key:n.key})),!(ce||((i=(s=D())==null?void 0:s.resolvedOptions)==null?void 0:i.document))&&(t._m==="server"||r)&&(n.props[`data-h-${n._hash}`]=""))},"tags:resolve":e=>{e.tags=e.tags.map(n=>(delete n.props._dynamic,n))}}}),fe=e=>({hooks:{"entries:updated":function(n){if(typeof(e==null?void 0:e.document)>"u"&&typeof window>"u")return;let t=e==null?void 0:e.delayFn;!t&&typeof requestAnimationFrame<"u"&&(t=requestAnimationFrame),Promise.resolve().then(function(){return X}).then(({debouncedRenderDOMHead:r})=>{r(n,{document:(e==null?void 0:e.document)||window.document,delayFn:t})})}}}),ue=()=>{const e=(n,t)=>{const r={},s={};Object.entries(t.props).forEach(([c,l])=>{c.startsWith("on")&&typeof l=="function"?s[c]=l:r[c]=l});let i;return n==="dom"&&t.tag==="script"&&typeof r.src=="string"&&typeof s.onload<"u"&&(i=r.src,delete r.src),{props:r,eventHandlers:s,delayedSrc:i}};return{hooks:{"ssr:render":function(n){n.tags=n.tags.map(t=>(t.props=e("ssr",t).props,t))},"dom:beforeRenderTag":function(n){const{props:t,eventHandlers:r,delayedSrc:s}=e("dom",n.tag);!Object.keys(r).length||(n.tag.props=t,n.tag._eventHandlers=r,n.tag._delayedSrc=s)},"dom:renderTag":function(n){const t=n.$el;if(!n.tag._eventHandlers||!t)return;const r=n.tag.tag==="bodyAttrs"&&typeof window<"u"?window:t;Object.entries(n.tag._eventHandlers).forEach(([s,i])=>{const c=`${n.tag._d||n.tag._p}:${s}`,l=s.slice(2).toLowerCase(),f=`data-h-${l}`;if(delete n.staleSideEffects[c],t.hasAttribute(f))return;const u=i;t.setAttribute(f,""),r.addEventListener(l,u),n.entry&&(n.entry._sde[c]=()=>{r.removeEventListener(l,u),t.removeAttribute(f)})}),n.tag._delayedSrc&&t.setAttribute("src",n.tag._delayedSrc)}}}};function pe(e){return Array.isArray(e)?e:[e]}const j=["base","meta","link","style","script","noscript"];let R;const he=e=>R=e,D=()=>R,ye=10;async function ge(e){const n=[];return Object.entries(e.resolvedInput||e.input).filter(([t,r])=>typeof r<"u"&&Y.includes(t)).forEach(([t,r])=>{const s=pe(r);n.push(...s.map(i=>x(t,i)).flat())}),(await Promise.all(n)).flat().map((t,r)=>(t._e=e._i,t._p=(e._i<<ye)+r,t))}const me=()=>[oe(),ie(),ae(),le(),ue(),de()],be=(e={})=>[fe({document:e==null?void 0:e.document,delayFn:e==null?void 0:e.domDelayFn})];function $e(e={}){const n=_e({...e,plugins:[...be(e),...(e==null?void 0:e.plugins)||[]]});return he(n),n}function _e(e={}){let n=[],t={},r=0;const s=M();e!=null&&e.hooks&&s.addHooks(e.hooks),e.plugins=[...me(),...(e==null?void 0:e.plugins)||[]],e.plugins.forEach(l=>l.hooks&&s.addHooks(l.hooks));const i=()=>s.callHook("entries:updated",c),c={resolvedOptions:e,headEntries(){return n},get hooks(){return s},use(l){l.hooks&&s.addHooks(l.hooks)},push(l,f){const u={_i:r++,input:l,_sde:{}};return f!=null&&f.mode&&(u._m=f==null?void 0:f.mode),n.push(u),i(),{dispose(){n=n.filter(p=>p._i!==u._i?!0:(t={...t,...p._sde||{}},p._sde={},i(),!1))},patch(p){n=n.map(y=>(y._i===u._i&&(u.input=y.input=p,i()),y))}}},async resolveTags(){const l={tags:[],entries:[...n]};await s.callHook("entries:resolve",l);for(const f of l.entries)for(const u of await ge(f)){const p={tag:u,entry:f};await s.callHook("tag:normalise",p),l.tags.push(p.tag)}return await s.callHook("tags:resolve",l),l.tags},_elMap:{},_popSideEffectQueue(){const l={...t};return t={},l}};return c.hooks.callHook("init",c),c}function ve(e){return typeof e=="function"?e():k(e)}function T(e,n=""){if(e instanceof Promise)return e;const t=ve(e);if(!e||!t)return t;if(Array.isArray(t))return t.map(r=>T(r,n));if(typeof t=="object"){let r=!1;const s=Object.fromEntries(Object.entries(t).map(([i,c])=>i==="titleTemplate"||i.startsWith("on")?[i,k(c)]:((typeof c=="function"||B(c))&&(r=!0),[i,T(c,i)])));return r&&j.includes(String(n))&&(s._dynamic=!0),s}return t}const Te=q.startsWith("3"),we=typeof window<"u",E="usehead";function P(){return S()&&U(E)||D()}function De(e={}){const n=$e({...e,domDelayFn:r=>setTimeout(()=>L(()=>r()),10),plugins:[He(),...(e==null?void 0:e.plugins)||[]]}),t={install(r){Te&&(r.config.globalProperties.$unhead=n,r.provide(E,n))}};return n.install=t.install,n}const He=()=>({hooks:{"entries:resolve":function(e){for(const n of e.entries)n.resolvedInput=T(n.input)}}}),Me=function(e,n){e.mixin({beforeCreate(){const t=this.$options,r=t.provide;t.provide=function(){let s;return typeof r=="function"?s=r.call(this):s=r||{},{...s,[E]:n}}}})};function Ae(e,n={}){const t=P(),r=K({});W(()=>{r.value=T(e)});const s=t.push(r.value,n);return F(r,c=>s.patch(c)),S()&&N(()=>{s.dispose()}),s}function Ee(e,n={}){return P().push(e,n)}function Le(e,n={}){var r;const t=P();if(t){const s=we||!!((r=t.resolvedOptions)!=null&&r.document);return n.mode==="server"&&s||n.mode==="client"&&!s?void 0:s?Ae(e,n):Ee(e,n)}}const Pe=["script","style","noscript"],Oe=["base","meta","link","style","script","noscript"],Ce=["base","title","titleTemplate","bodyAttrs","htmlAttrs"];function Se(e,n){const{props:t,tag:r}=e;if(Ce.includes(r))return r;if(r==="link"&&t.rel==="canonical")return"canonical";if(t.charset)return"charset";const s=["id"];r==="meta"&&s.push("name","property","http-equiv");for(const i of s)if(typeof t[i]<"u"){const c=String(t[i]);return n&&!n(c)?!1:`${r}:${i}:${c}`}return!1}const _=(e,n)=>{const{tag:t,$el:r}=e;!r||(Object.entries(t.props).forEach(([s,i])=>{i=String(i);const c=`attr:${s}`;if(s==="class"){if(!i)return;for(const l of i.split(" ")){const f=`${c}:${l}`;n&&n(e,f,()=>r.classList.remove(l)),r.classList.contains(l)||r.classList.add(l)}return}n&&!s.startsWith("data-h-")&&n(e,c,()=>r.removeAttribute(s)),r.getAttribute(s)!==i&&r.setAttribute(s,i)}),Pe.includes(t.tag)&&r.innerHTML!==(t.children||"")&&(r.innerHTML=t.children||""))};function ke(e){let n=9;for(let t=0;t<e.length;)n=Math.imul(n^e.charCodeAt(t++),9**9);return((n^n>>>9)+65536).toString(16).substring(1,8).toLowerCase()}async function Ie(e,n={}){var p,y;const t={shouldRender:!0};if(await e.hooks.callHook("dom:beforeRender",t),!t.shouldRender)return;const r=n.document||window.document,s=e._popSideEffectQueue();e.headEntries().map(d=>d._sde).forEach(d=>{Object.entries(d).forEach(([o,a])=>{s[o]=a})});const i=async d=>{const o=e.headEntries().find(g=>g._i===d._e),a={renderId:d._d||ke(JSON.stringify({...d,_e:void 0,_p:void 0})),$el:null,shouldRender:!0,tag:d,entry:o,staleSideEffects:s};return await e.hooks.callHook("dom:beforeRenderTag",a),a},c=[],l={body:[],head:[]},f=(d,o,a)=>{o=`${d.renderId}:${o}`,d.entry&&(d.entry._sde[o]=a),delete s[o]},u=d=>{e._elMap[d.renderId]=d.$el,c.push(d),f(d,"el",()=>{var o;(o=d.$el)==null||o.remove(),delete e._elMap[d.renderId]})};for(const d of await e.resolveTags()){const o=await i(d);if(!o.shouldRender)continue;const{tag:a}=o;if(a.tag==="title"){r.title=a.children||"",c.push(o);continue}if(a.tag==="htmlAttrs"||a.tag==="bodyAttrs"){o.$el=r[a.tag==="htmlAttrs"?"documentElement":"body"],_(o,f),c.push(o);continue}if(o.$el=e._elMap[o.renderId],!o.$el&&a._hash&&(o.$el=r.querySelector(`${(p=a.tagPosition)!=null&&p.startsWith("body")?"body":"head"} > ${a.tag}[data-h-${a._hash}]`)),o.$el){o.tag._d&&_(o),u(o);continue}o.$el=r.createElement(a.tag),_(o),l[(y=a.tagPosition)!=null&&y.startsWith("body")?"body":"head"].push(o)}Object.entries(l).forEach(([d,o])=>{if(!!o.length){for(const a of[...r[d].children].reverse()){const g=a.tagName.toLowerCase();if(!Oe.includes(g))continue;const w=Se({tag:g,props:a.getAttributeNames().reduce((h,b)=>({...h,[b]:a.getAttribute(b)}),{})}),m=o.findIndex(h=>h&&(h.tag._d===w||a.isEqualNode(h.$el)));if(m!==-1){const h=o[m];h.$el=a,_(h),u(h),delete o[m]}}o.forEach(a=>{if(!!a.$el){switch(a.tag.tagPosition){case"bodyClose":r.body.appendChild(a.$el);break;case"bodyOpen":r.body.insertBefore(a.$el,r.body.firstChild);break;case"head":default:r.head.appendChild(a.$el);break}u(a)}})}});for(const d of c)await e.hooks.callHook("dom:renderTag",d);Object.values(s).forEach(d=>d())}let H=null;async function Ue(e,n={}){function t(){return H=null,Ie(e,n)}const r=n.delayFn||(s=>setTimeout(s,10));return H=H||new Promise(s=>r(()=>s(t())))}export{Me as V,De as c,Ue as d,Ie as r,Le as u};
