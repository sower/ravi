import{d as _,H as P,h as M,n as x,t as T}from"./@unhead_shared@1.11.10-C1bv5ODb.js";async function w(n,p={}){const r=p.document||n.resolvedOptions.document;if(!r||!n.dirty)return;const f={shouldRender:!0,tags:[]};if(await n.hooks.callHook("dom:beforeRender",f),!!f.shouldRender)return n._domUpdatePromise||(n._domUpdatePromise=new Promise(async g=>{var C;const m=(await n.resolveTags()).map(e=>({tag:e,id:P.has(e.tag)?M(e):e.tag,shouldRender:!0}));let i=n._dom;if(!i){i={elMap:{htmlAttrs:r.documentElement,bodyAttrs:r.body}};const e=new Set;for(const t of["body","head"]){const o=(C=r[t])==null?void 0:C.children;for(const d of o){const s=d.tagName.toLowerCase();if(!P.has(s))continue;const c={tag:s,props:await x(d.getAttributeNames().reduce((b,H)=>({...b,[H]:d.getAttribute(H)}),{})),innerHTML:d.innerHTML},u=T(c);let a=u,h=1;for(;a&&e.has(a);)a=`${u}:${h++}`;a&&(c._d=a,e.add(a)),i.elMap[d.getAttribute("data-hid")||M(c)]=d}}}i.pendingSideEffects={...i.sideEffects},i.sideEffects={};function y(e,t,o){const d=`${e}:${t}`;i.sideEffects[d]=o,delete i.pendingSideEffects[d]}function v({id:e,$el:t,tag:o}){const d=o.tag.endsWith("Attrs");if(i.elMap[e]=t,d||(o.textContent&&o.textContent!==t.textContent&&(t.textContent=o.textContent),o.innerHTML&&o.innerHTML!==t.innerHTML&&(t.innerHTML=o.innerHTML),y(e,"el",()=>{var s;(s=i.elMap[e])==null||s.remove(),delete i.elMap[e]})),o._eventHandlers)for(const s in o._eventHandlers)Object.prototype.hasOwnProperty.call(o._eventHandlers,s)&&t.getAttribute(`data-${s}`)!==""&&((o.tag==="bodyAttrs"?r.defaultView:t).addEventListener(s.substring(2),o._eventHandlers[s].bind(t)),t.setAttribute(`data-${s}`,""));for(const s in o.props){if(!Object.prototype.hasOwnProperty.call(o.props,s))continue;const c=o.props[s],u=`attr:${s}`;if(s==="class"){if(!c)continue;for(const a of c.split(" "))d&&y(e,`${u}:${a}`,()=>t.classList.remove(a)),!t.classList.contains(a)&&t.classList.add(a)}else if(s==="style"){if(!c)continue;for(const a of c.split(";")){const h=a.indexOf(":"),b=a.substring(0,h).trim(),H=a.substring(h+1).trim();y(e,`${u}:${b}`,()=>{t.style.removeProperty(b)}),t.style.setProperty(b,H)}}else t.getAttribute(s)!==c&&t.setAttribute(s,c===!0?"":String(c)),d&&y(e,u,()=>t.removeAttribute(s))}}const k=[],l={bodyClose:void 0,bodyOpen:void 0,head:void 0};for(const e of m){const{tag:t,shouldRender:o,id:d}=e;if(o){if(t.tag==="title"){r.title=t.textContent;continue}e.$el=e.$el||i.elMap[d],e.$el?v(e):P.has(t.tag)&&k.push(e)}}for(const e of k){const t=e.tag.tagPosition||"head";e.$el=r.createElement(e.tag.tag),v(e),l[t]=l[t]||r.createDocumentFragment(),l[t].appendChild(e.$el)}for(const e of m)await n.hooks.callHook("dom:renderTag",e,r,y);l.head&&r.head.appendChild(l.head),l.bodyOpen&&r.body.insertBefore(l.bodyOpen,r.body.firstChild),l.bodyClose&&r.body.appendChild(l.bodyClose);for(const e in i.pendingSideEffects)i.pendingSideEffects[e]();n._dom=i,await n.hooks.callHook("dom:rendered",{renders:m}),g()}).finally(()=>{n._domUpdatePromise=void 0,n.dirty=!1})),n._domUpdatePromise}function A(n,p={}){const r=p.delayFn||(f=>setTimeout(f,10));return n._domDebouncedUpdatePromise=n._domDebouncedUpdatePromise||new Promise(f=>r(()=>w(n,p).then(()=>{delete n._domDebouncedUpdatePromise,f()})))}function O(n){return _(p=>{var f,g;const r=((g=(f=p.resolvedOptions.document)==null?void 0:f.head.querySelector('script[id="unhead:payload"]'))==null?void 0:g.innerHTML)||!1;return r&&p.push(JSON.parse(r)),{mode:"client",hooks:{"entries:updated":m=>{A(m,n)}}}})}export{O as D};
