import{c as b,b as I}from"./@vue_runtime-dom@3.2.47-7b017c2d.js";import{c as g,a as v,b as P}from"./vue-router@4.1.6_vue@3.2.47-507b3659.js";import{c as T}from"./@vueuse_head@1.1.23_vue@3.2.47-5b812f12.js";import{z as E,j as H}from"./@vue_runtime-core@3.2.47-5055464e.js";import{r as L}from"./@vue_reactivity@3.2.47-77826540.js";function O(t){try{return JSON.parse(t||"{}")}catch(e){return console.error("[SSG] On state deserialization -",e,t),{}}}function z(t){return document.readyState==="loading"?new Promise(e=>{document.addEventListener("DOMContentLoaded",()=>e(t))}):Promise.resolve(t)}const M=E({setup(t,{slots:e}){const o=L(!1);return H(()=>o.value=!0),()=>o.value?e.default&&e.default({}):e.placeholder&&e.placeholder({})}});function J(t,e,o,R={}){const{transformState:s,registerComponents:y=!0,useHead:w=!0,rootContainer:h="#app"}=R,l=typeof window<"u";async function m(a=!1,c){const u=a?b(t):I(t);let d;w&&(d=T(),u.use(d));const i=g({history:a?v(e.base):P(e.base),...e}),{routes:A}=e;y&&u.component("ClientOnly",M);const S=[],n={app:u,head:d,isClient:l,router:i,routes:A,onSSRAppRendered:a?()=>{}:r=>S.push(r),triggerOnSSRAppRendered:()=>Promise.all(S.map(r=>r())),initialState:{},transformState:s,routePath:c};a&&(await z(),n.initialState=(s==null?void 0:s(window.__INITIAL_STATE__||{}))||O(window.__INITIAL_STATE__)),await(o==null?void 0:o(n)),u.use(i);let p,f=!0;if(i.beforeEach((r,G,C)=>{(f||p&&p===r.path)&&(f=!1,p=r.path,r.meta.state=n.initialState),C()}),!a){const r=n.routePath??"/";i.push(r),await i.isReady(),n.initialState=i.currentRoute.value.meta.state||{}}const _=n.initialState;return{...n,initialState:_}}return l&&(async()=>{const{app:a,router:c}=await m(!0);await c.isReady(),a.mount(h,!0)})(),m}export{J as V};
