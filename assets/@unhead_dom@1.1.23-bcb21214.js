import{c as R,h as A,H as I,t as P,T as S,d as v}from"./@unhead_shared@1.1.23-886f2746.js";const C=(t,a=!1,d)=>{const{tag:r,$el:o}=t;o&&(Object.entries(r.props).forEach(([l,f])=>{f=String(f);const $=`attr:${l}`;if(l==="class"){if(!f)return;for(const c of f.split(" ")){const H=`${$}:${c}`;d&&d(t,H,()=>o.classList.remove(c)),o.classList.contains(c)||o.classList.add(c)}return}d&&!l.startsWith("data-h-")&&d(t,$,()=>o.removeAttribute(l)),(a||o.getAttribute(l)!==f)&&o.setAttribute(l,f)}),S.includes(r.tag)&&(r.textContent&&r.textContent!==o.textContent?o.textContent=r.textContent:r.innerHTML&&r.innerHTML!==o.innerHTML&&(o.innerHTML=r.innerHTML)))};let b=!1;async function D(t,a={}){var M,w;const d={shouldRender:!0};if(await t.hooks.callHook("dom:beforeRender",d),!d.shouldRender)return;const r=a.document||t.resolvedOptions.document||window.document,o=(await t.resolveTags()).map($);if(t.resolvedOptions.experimentalHashHydration&&(b=b||t._hash||!1,b)){const e=R(o.map(n=>n.tag._h));if(b===e)return;b=e}const l=t._popSideEffectQueue();t.headEntries().map(e=>e._sde).forEach(e=>{Object.entries(e).forEach(([n,h])=>{l[n]=h})});const f=(e,n,h)=>{n=`${e.renderId}:${n}`,e.entry&&(e.entry._sde[n]=h),delete l[n]};function $(e){const n=t.headEntries().find(g=>g._i===e._e),h={renderId:e._d||A(e),$el:null,shouldRender:!0,tag:e,entry:n,markSideEffect:(g,s)=>f(h,g,s)};return h}const c=[],H={body:[],head:[]},T=e=>{t._elMap[e.renderId]=e.$el,c.push(e),f(e,"el",()=>{var n;(n=e.$el)==null||n.remove(),delete t._elMap[e.renderId]})};for(const e of o){if(await t.hooks.callHook("dom:beforeRenderTag",e),!e.shouldRender)continue;const{tag:n}=e;if(n.tag==="title"){r.title=n.textContent||"",c.push(e);continue}if(n.tag==="htmlAttrs"||n.tag==="bodyAttrs"){e.$el=r[n.tag==="htmlAttrs"?"documentElement":"body"],C(e,!1,f),c.push(e);continue}if(e.$el=t._elMap[e.renderId],!e.$el&&n.key&&(e.$el=r.querySelector(`${(M=n.tagPosition)!=null&&M.startsWith("body")?"body":"head"} > ${n.tag}[data-h-${n._h}]`)),e.$el){e.tag._d&&C(e),T(e);continue}H[(w=n.tagPosition)!=null&&w.startsWith("body")?"body":"head"].push(e)}const u={bodyClose:void 0,bodyOpen:void 0,head:void 0};Object.entries(H).forEach(([e,n])=>{var g;if(!n.length)return;const h=(g=r==null?void 0:r[e])==null?void 0:g.children;if(h){for(const s of[...h].reverse()){const y=s.tagName.toLowerCase();if(!I.includes(y))continue;const L=s.getAttributeNames().reduce((i,m)=>({...i,[m]:s.getAttribute(m)}),{}),_={tag:y,props:L};s.innerHTML&&(_.innerHTML=s.innerHTML);const O=A(_);let p=n.findIndex(i=>(i==null?void 0:i.renderId)===O);if(p===-1){const i=P(_);p=n.findIndex(m=>(m==null?void 0:m.tag._d)&&m.tag._d===i)}if(p!==-1){const i=n[p];i.$el=s,C(i),T(i),delete n[p]}}n.forEach(s=>{const y=s.tag.tagPosition||"head";u[y]=u[y]||r.createDocumentFragment(),s.$el||(s.$el=r.createElement(s.tag.tag),C(s,!0)),u[y].appendChild(s.$el),T(s)})}}),u.head&&r.head.appendChild(u.head),u.bodyOpen&&r.body.insertBefore(u.bodyOpen,r.body.firstChild),u.bodyClose&&r.body.appendChild(u.bodyClose);for(const e of c)await t.hooks.callHook("dom:renderTag",e);Object.values(l).forEach(e=>e())}let E=null;async function F(t,a={}){function d(){return E=null,D(t,a)}const r=a.delayFn||(o=>setTimeout(o,10));return E=E||new Promise(o=>r(()=>o(d())))}const K=t=>v({hooks:{"entries:updated":function(a){if(typeof(t==null?void 0:t.document)>"u"&&typeof window>"u")return;let d=t==null?void 0:t.delayFn;!d&&typeof requestAnimationFrame<"u"&&(d=requestAnimationFrame),F(a,{document:(t==null?void 0:t.document)||window.document,delayFn:d})}}});function W(t){var a;return((a=t==null?void 0:t.head.querySelector('meta[name="unhead:ssr"]'))==null?void 0:a.getAttribute("content"))||!1}export{K as P,F as d,W as m,D as r};
