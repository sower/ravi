function y(e){return Array.isArray(e)?e:[e]}const m=["title","titleTemplate","script","style","noscript"],H=["base","meta","link","style","script","noscript"],g=["title","titleTemplate","templateParams","base","htmlAttrs","bodyAttrs","meta","link","style","script","noscript"],h=["base","title","titleTemplate","bodyAttrs","htmlAttrs","templateParams"],d=["tagPosition","tagPriority","tagDuplicateStrategy","children","innerHTML","textContent","processTemplateParams"],S=typeof window<"u";function j(e){return e}function T(e){let n=9;for(let t=0;t<e.length;)n=Math.imul(n^e.charCodeAt(t++),9**9);return((n^n>>>9)+65536).toString(16).substring(1,8).toLowerCase()}function C(e){return e._h||T(e._d?e._d:`${e.tag}:${e.textContent||e.innerHTML||""}:${Object.entries(e.props).map(([n,t])=>`${n}:${String(t)}`).join(",")}`)}function E(e,n){const{props:t,tag:r}=e;if(h.includes(r))return r;if(r==="link"&&t.rel==="canonical")return"canonical";if(t.charset)return"charset";const i=["id"];r==="meta"&&i.push("name","property","http-equiv");for(const s of i)if(typeof t[s]<"u"){const o=String(t[s]);return n&&!n(o)?!1:`${r}:${s}:${o}`}return!1}function _(e,n){return e==null?n||null:typeof e=="function"?e(n):e}async function b(e,n,t){const r={tag:e,props:await w(typeof n=="object"&&typeof n!="function"&&!(n instanceof Promise)?{...n}:{[["script","noscript","style"].includes(e)?"innerHTML":"textContent"]:n},["templateParams","titleTemplate"].includes(e))};return d.forEach(i=>{const s=typeof r.props[i]<"u"?r.props[i]:t[i];typeof s<"u"&&((!["innerHTML","textContent","children"].includes(i)||m.includes(r.tag))&&(r[i==="children"?"innerHTML":i]=s),delete r.props[i])}),r.props.body&&(r.tagPosition="bodyClose",delete r.props.body),r.tag==="script"&&typeof r.innerHTML=="object"&&(r.innerHTML=JSON.stringify(r.innerHTML),r.props.type=r.props.type||"application/json"),Array.isArray(r.props.content)?r.props.content.map(i=>({...r,props:{...r.props,content:i}})):r}function A(e){return typeof e=="object"&&!Array.isArray(e)&&(e=Object.keys(e).filter(n=>e[n])),(Array.isArray(e)?e.join(" "):e).split(" ").filter(n=>n.trim()).filter(Boolean).join(" ")}async function w(e,n){for(const t of Object.keys(e)){if(t==="class"){e[t]=A(e[t]);continue}if(e[t]instanceof Promise&&(e[t]=await e[t]),!n&&!d.includes(t)){const r=String(e[t]),i=t.startsWith("data-");r==="true"||r===""?e[t]=i?"true":!0:e[t]||(i&&r==="false"?e[t]="false":delete e[t])}}return e}const P=10;async function L(e){const n=[];return Object.entries(e.resolvedInput).filter(([t,r])=>typeof r<"u"&&g.includes(t)).forEach(([t,r])=>{const i=y(r);n.push(...i.map(s=>b(t,s,e)).flat())}),(await Promise.all(n)).flat().filter(Boolean).map((t,r)=>(t._e=e._i,e.mode&&(t._m=e.mode),t._p=(e._i<<P)+r,t))}const p={base:-10,title:10},u={critical:-80,high:-10,low:20};function M(e){let n=100;const t=e.tagPriority;return typeof t=="number"?t:(e.tag==="meta"?(e.props["http-equiv"]==="content-security-policy"&&(n=-30),e.props.charset&&(n=-20),e.props.name==="viewport"&&(n=-15)):e.tag==="link"&&e.props.rel==="preconnect"?n=20:e.tag in p&&(n=p[e.tag]),typeof t=="string"&&t in u?n+u[t]:n)}const x=[{prefix:"before:",offset:-1},{prefix:"after:",offset:1}],I=["onload","onerror","onabort","onprogress","onloadstart"],c="%separator";function $(e,n,t){if(typeof e!="string"||!e.includes("%"))return e;function r(o){let a;return["s","pageTitle"].includes(o)?a=n.pageTitle:o.includes(".")?a=o.split(".").reduce((l,f)=>l&&l[f]||void 0,n):a=n[o],typeof a<"u"?(a||"").replace(/"/g,'\\"'):!1}let i=e;try{i=decodeURI(e)}catch{}return(i.match(/%(\w+\.+\w+)|%(\w+)/g)||[]).sort().reverse().forEach(o=>{const a=r(o.slice(1));typeof a=="string"&&(e=e.replace(new RegExp(`\\${o}(\\W|$)`,"g"),(l,f)=>`${a}${f}`).trim())}),e.includes(c)&&(e.endsWith(c)&&(e=e.slice(0,-c.length).trim()),e.startsWith(c)&&(e=e.slice(c.length).trim()),e=e.replace(new RegExp(`\\${c}\\s*\\${c}`,"g"),c),e=$(e,{separator:t},t)),e}export{H,S as I,I as N,x as S,M as a,T as b,L as c,j as d,C as h,w as n,$ as p,_ as r,E as t};
