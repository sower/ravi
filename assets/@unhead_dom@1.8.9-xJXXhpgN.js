import{d as H,H as g,h as E,n as M,t as T}from"./@unhead_shared@1.8.9-fjCBxbYg.js";async function w(t){const a={tag:t.tagName.toLowerCase(),props:await M(t.getAttributeNames().reduce((o,i)=>({...o,[i]:t.getAttribute(i)}),{})),innerHTML:t.innerHTML};return a._d=T(a),a}async function A(t,a={}){var h;const o=a.document||t.resolvedOptions.document;if(!o)return;const i={shouldRender:t.dirty,tags:[]};if(await t.hooks.callHook("dom:beforeRender",i),!i.shouldRender)return;const f=(await t.resolveTags()).map(e=>({tag:e,id:g.includes(e.tag)?E(e):e.tag,shouldRender:!0}));let s=t._dom;if(!s){s={elMap:{htmlAttrs:o.documentElement,bodyAttrs:o.body}};for(const e of["body","head"]){const n=(h=o==null?void 0:o[e])==null?void 0:h.children;for(const r of[...n].filter(c=>g.includes(c.tagName.toLowerCase())))s.elMap[r.getAttribute("data-hid")||E(await w(r))]=r}}s.pendingSideEffects={...s.sideEffects||{}},s.sideEffects={};function u(e,n,r){const c=`${e}:${n}`;s.sideEffects[c]=r,delete s.pendingSideEffects[c]}function y({id:e,$el:n,tag:r}){const c=r.tag.endsWith("Attrs");s.elMap[e]=n,c||(["textContent","innerHTML"].forEach(d=>{r[d]&&r[d]!==n[d]&&(n[d]=r[d])}),u(e,"el",()=>{s.elMap[e].remove(),delete s.elMap[e]})),Object.entries(r.props).forEach(([d,p])=>{const C=`attr:${d}`;if(d==="class")for(const m of(p||"").split(" ").filter(Boolean))c&&u(e,`${C}:${m}`,()=>n.classList.remove(m)),!n.classList.contains(m)&&n.classList.add(m);else n.getAttribute(d)!==p&&n.setAttribute(d,p===!0?"":String(p)),c&&u(e,C,()=>n.removeAttribute(d))})}const b=[],l={bodyClose:void 0,bodyOpen:void 0,head:void 0};for(const e of f){const{tag:n,shouldRender:r,id:c}=e;if(r){if(n.tag==="title"){o.title=n.textContent;continue}e.$el=e.$el||s.elMap[c],e.$el?y(e):g.includes(n.tag)&&b.push(e)}}for(const e of b){const n=e.tag.tagPosition||"head";e.$el=o.createElement(e.tag.tag),y(e),l[n]=l[n]||o.createDocumentFragment(),l[n].appendChild(e.$el)}for(const e of f)await t.hooks.callHook("dom:renderTag",e,o,u);l.head&&o.head.appendChild(l.head),l.bodyOpen&&o.body.insertBefore(l.bodyOpen,o.body.firstChild),l.bodyClose&&o.body.appendChild(l.bodyClose),Object.values(s.pendingSideEffects).forEach(e=>e()),t._dom=s,t.dirty=!1,await t.hooks.callHook("dom:rendered",{renders:f})}async function O(t,a={}){const o=a.delayFn||(i=>setTimeout(i,10));return t._domUpdatePromise=t._domUpdatePromise||new Promise(i=>o(async()=>{await A(t,a),delete t._domUpdatePromise,i()}))}function P(t){return H(a=>{var i,f;const o=((f=(i=a.resolvedOptions.document)==null?void 0:i.head.querySelector('script[id="unhead:payload"]'))==null?void 0:f.innerHTML)||!1;return o&&a.push(JSON.parse(o)),{mode:"client",hooks:{"entries:updated":function(s){O(s,t)}}}})}export{P as D};
