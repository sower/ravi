import{c as _}from"./hookable@5.5.3-Cuq9Dhxc.js";import{D as P}from"./@unhead_dom@1.8.9-xJXXhpgN.js";import{I as $,d as u,t as E,a as g,H as k,b as y,N as T,S as w,p as h,r as m,c as C}from"./@unhead_shared@1.8.9-fjCBxbYg.js";const b=["templateParams","htmlAttrs","bodyAttrs"],M=u({hooks:{"tag:normalise":function({tag:n}){["hid","vmid","key"].forEach(t=>{n.props[t]&&(n.key=n.props[t],delete n.props[t])});const s=E(n)||(n.key?`${n.tag}:${n.key}`:!1);s&&(n._d=s)},"tags:resolve":function(n){const e={};n.tags.forEach(t=>{const i=(t.key?`${t.tag}:${t.key}`:t._d)||t._p,a=e[i];if(a){let p=t==null?void 0:t.tagDuplicateStrategy;if(!p&&b.includes(t.tag)&&(p="merge"),p==="merge"){const o=a.props;["class","style"].forEach(r=>{o[r]&&(t.props[r]?(r==="style"&&!o[r].endsWith(";")&&(o[r]+=";"),t.props[r]=`${o[r]} ${t.props[r]}`):t.props[r]=o[r])}),e[i].props={...o,...t.props};return}else if(t._e===a._e){a._duped=a._duped||[],t._d=`${a._d}:${a._duped.length+1}`,a._duped.push(t);return}else if(g(t)>g(a))return}const d=Object.keys(t.props).length+(t.innerHTML?1:0)+(t.textContent?1:0);if(k.includes(t.tag)&&d===0){delete e[i];return}e[i]=t});const s=[];Object.values(e).forEach(t=>{const i=t._duped;delete t._duped,s.push(t),i&&s.push(...i)}),n.tags=s,n.tags=n.tags.filter(t=>!(t.tag==="meta"&&(t.props.name||t.props.property)&&!t.props.content))}}}),L=u({mode:"server",hooks:{"tags:resolve":function(n){const e={};n.tags.filter(s=>["titleTemplate","templateParams","title"].includes(s.tag)&&s._m==="server").forEach(s=>{e[s.tag]=s.tag.startsWith("title")?s.textContent:s.props}),Object.keys(e).length&&n.tags.push({tag:"script",innerHTML:JSON.stringify(e),props:{id:"unhead:payload",type:"application/json"}})}}}),A=["script","link","bodyAttrs"];function I(n){const e={},s={};return Object.entries(n.props).forEach(([t,i])=>{t.startsWith("on")&&typeof i=="function"?(T.includes(t)&&(e[t]=`this.dataset.${t} = true`),s[t]=i):e[t]=i}),{props:e,eventHandlers:s}}const j=u(n=>({hooks:{"tags:resolve":function(e){for(const s of e.tags)if(A.includes(s.tag)){const{props:t,eventHandlers:i}=I(s);s.props=t,Object.keys(i).length&&((s.props.src||s.props.href)&&(s.key=s.key||y(s.props.src||s.props.href)),s._eventHandlers=i)}},"dom:renderTag":function(e,s,t){if(!e.tag._eventHandlers)return;const i=e.tag.tag==="bodyAttrs"?s.defaultView:e.$el;Object.entries(e.tag._eventHandlers).forEach(([a,d])=>{const p=`${e.tag._d||e.tag._p}:${a}`,o=a.slice(2).toLowerCase(),r=`data-h-${o}`;if(t(e.id,p,()=>{}),e.$el.hasAttribute(r))return;e.$el.setAttribute(r,"");let l;const c=f=>{d(f),l==null||l.disconnect()};a in e.$el.dataset?c(new Event(a.replace("on",""))):T.includes(a)&&typeof MutationObserver<"u"?(l=new MutationObserver(f=>{f.some(H=>H.attributeName===`data-${a}`)&&(c(new Event(a.replace("on",""))),l==null||l.disconnect())}),l.observe(e.$el,{attributes:!0})):i.addEventListener(o,c),t(e.id,p,()=>{l==null||l.disconnect(),i.removeEventListener(o,c),e.$el.removeAttribute(r)})})}}})),S=["link","style","script","noscript"],K=u({hooks:{"tag:normalise":({tag:n})=>{n.key&&S.includes(n.tag)&&(n.props["data-hid"]=n._h=y(n.key))}}}),D=u({hooks:{"tags:resolve":n=>{const e=s=>{var t;return(t=n.tags.find(i=>i._d===s))==null?void 0:t._p};for(const{prefix:s,offset:t}of w)for(const i of n.tags.filter(a=>typeof a.tagPriority=="string"&&a.tagPriority.startsWith(s))){const a=e(i.tagPriority.replace(s,""));typeof a<"u"&&(i._p=a+t)}n.tags.sort((s,t)=>s._p-t._p).sort((s,t)=>g(s)-g(t))}}}),O={meta:"content",link:"href",htmlAttrs:"lang"},N=u(n=>({hooks:{"tags:resolve":e=>{var p;const{tags:s}=e,t=(p=s.find(o=>o.tag==="title"))==null?void 0:p.textContent,i=s.findIndex(o=>o.tag==="templateParams"),a=i!==-1?s[i].props:{},d=a.separator||"|";delete a.separator,a.pageTitle=h(a.pageTitle||t||"",a,d);for(const o of s.filter(r=>r.processTemplateParams!==!1)){const r=O[o.tag];r&&typeof o.props[r]=="string"?o.props[r]=h(o.props[r],a,d):(o.processTemplateParams===!0||["titleTemplate","title"].includes(o.tag))&&["innerHTML","textContent"].forEach(l=>{typeof o[l]=="string"&&(o[l]=h(o[l],a,d))})}n._templateParams=a,n._separator=d,e.tags=s.filter(o=>o.tag!=="templateParams")}}})),W=u({hooks:{"tags:resolve":n=>{const{tags:e}=n;let s=e.findIndex(i=>i.tag==="titleTemplate");const t=e.findIndex(i=>i.tag==="title");if(t!==-1&&s!==-1){const i=m(e[s].textContent,e[t].textContent);i!==null?e[t].textContent=i||e[t].textContent:delete e[t]}else if(s!==-1){const i=m(e[s].textContent);i!==null&&(e[s].textContent=i,e[s].tag="title",s=-1)}s!==-1&&delete e[s],n.tags=e.filter(Boolean)}}}),R=u({hooks:{"tags:afterResolve":function(n){for(const e of n.tags)typeof e.innerHTML=="string"&&(e.innerHTML&&["application/ld+json","application/json"].includes(e.props.type)?e.innerHTML=e.innerHTML.replace(/</g,"\\u003C"):e.innerHTML=e.innerHTML.replace(new RegExp(`</${e.tag}`,"g"),`<\\/${e.tag}`))}}});function U(n={}){const e=B(n);return e.use(P()),e}function v(n,e){return!n||n==="server"&&e||n==="client"&&!e}function B(n={}){const e=_();e.addHooks(n.hooks||{}),n.document=n.document||($?document:void 0);const s=!n.document,t=()=>{p.dirty=!0,e.callHook("entries:updated",p)};let i=0,a=[];const d=[],p={plugins:d,dirty:!1,resolvedOptions:n,hooks:e,headEntries(){return a},use(o){const r=typeof o=="function"?o(p):o;(!r.key||!d.some(l=>l.key===r.key))&&(d.push(r),v(r.mode,s)&&e.addHooks(r.hooks||{}))},push(o,r){r==null||delete r.head;const l={_i:i++,input:o,...r};return v(l.mode,s)&&(a.push(l),t()),{dispose(){a=a.filter(c=>c._i!==l._i),e.callHook("entries:updated",p),t()},patch(c){a=a.map(f=>(f._i===l._i&&(f.input=l.input=c),f)),t()}}},async resolveTags(){const o={tags:[],entries:[...a]};await e.callHook("entries:resolve",o);for(const r of o.entries){const l=r.resolvedInput||r.input;if(r.resolvedInput=await(r.transform?r.transform(l):l),r.resolvedInput)for(const c of await C(r)){const f={tag:c,entry:r,resolvedOptions:p.resolvedOptions};await e.callHook("tag:normalise",f),o.tags.push(f.tag)}}return await e.callHook("tags:beforeResolve",o),await e.callHook("tags:resolve",o),await e.callHook("tags:afterResolve",o),o.tags},ssr:s};return[M,L,j,K,D,N,W,R,...(n==null?void 0:n.plugins)||[]].forEach(o=>p.use(o)),p.hooks.callHook("init",p),p}export{U as c};
