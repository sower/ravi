import{D as T}from"./@unhead_dom@1.11.10-CNTx9FV3.js";import{I as _,d as f,t as H,h as P,a as h,H as w,N as m,b as v,S as C,p as u,r as y,c as b}from"./@unhead_shared@1.11.10-C1bv5ODb.js";import{c as M}from"./hookable@5.5.3-B8xFkYCm.js";const S=new Set(["templateParams","htmlAttrs","bodyAttrs"]),x=f({hooks:{"tag:normalise":({tag:t})=>{t.props.hid&&(t.key=t.props.hid,delete t.props.hid),t.props.vmid&&(t.key=t.props.vmid,delete t.props.vmid),t.props.key&&(t.key=t.props.key,delete t.props.key);const s=H(t);s&&!s.startsWith("meta:og:")&&!s.startsWith("meta:twitter:")&&delete t.key;const o=s||(t.key?`${t.tag}:${t.key}`:!1);o&&(t._d=o)},"tags:resolve":t=>{const s=Object.create(null);for(const e of t.tags){const n=(e.key?`${e.tag}:${e.key}`:e._d)||P(e),a=s[n];if(a){let r=e==null?void 0:e.tagDuplicateStrategy;if(!r&&S.has(e.tag)&&(r="merge"),r==="merge"){const i=a.props;i.style&&e.props.style&&(i.style[i.style.length-1]!==";"&&(i.style+=";"),e.props.style=`${i.style} ${e.props.style}`),i.class&&e.props.class?e.props.class=`${i.class} ${e.props.class}`:i.class&&(e.props.class=i.class),s[n].props={...i,...e.props};continue}else if(e._e===a._e){a._duped=a._duped||[],e._d=`${a._d}:${a._duped.length+1}`,a._duped.push(e);continue}else if(h(e)>h(a))continue}if(!(e.innerHTML||e.textContent||Object.keys(e.props).length!==0)&&w.has(e.tag)){delete s[n];continue}s[n]=e}const o=[];for(const e in s){const n=s[e],a=n._duped;o.push(n),a&&(delete n._duped,o.push(...a))}t.tags=o,t.tags=t.tags.filter(e=>!(e.tag==="meta"&&(e.props.name||e.props.property)&&!e.props.content))}}}),E=new Set(["script","link","bodyAttrs"]),L=f(t=>({hooks:{"tags:resolve":s=>{for(const o of s.tags){if(!E.has(o.tag))continue;const e=o.props;for(const n in e){if(n[0]!=="o"||n[1]!=="n"||!Object.prototype.hasOwnProperty.call(e,n))continue;const a=e[n];typeof a=="function"&&(t.ssr&&m.has(n)?e[n]=`this.dataset.${n}fired = true`:delete e[n],o._eventHandlers=o._eventHandlers||{},o._eventHandlers[n]=a)}t.ssr&&o._eventHandlers&&(o.props.src||o.props.href)&&(o.key=o.key||v(o.props.src||o.props.href))}},"dom:renderTag":({$el:s,tag:o})=>{var n,a;const e=s==null?void 0:s.dataset;if(e)for(const p in e){if(!p.endsWith("fired"))continue;const r=p.slice(0,-5);m.has(r)&&((a=(n=o._eventHandlers)==null?void 0:n[r])==null||a.call(s,new Event(r.substring(2))))}}}})),$=new Set(["link","style","script","noscript"]),W=f({hooks:{"tag:normalise":({tag:t})=>{t.key&&$.has(t.tag)&&(t.props["data-hid"]=t._h=v(t.key))}}}),j=f({mode:"server",hooks:{"tags:beforeResolve":t=>{const s={};let o=!1;for(const e of t.tags)e._m!=="server"||e.tag!=="titleTemplate"&&e.tag!=="templateParams"&&e.tag!=="title"||(s[e.tag]=e.tag==="title"||e.tag==="titleTemplate"?e.textContent:e.props,o=!0);o&&t.tags.push({tag:"script",innerHTML:JSON.stringify(s),props:{id:"unhead:payload",type:"application/json"}})}}}),A=f({hooks:{"tags:resolve":t=>{var s;for(const o of t.tags)if(typeof o.tagPriority=="string")for(const{prefix:e,offset:n}of C){if(!o.tagPriority.startsWith(e))continue;const a=o.tagPriority.substring(e.length),p=(s=t.tags.find(r=>r._d===a))==null?void 0:s._p;if(p!==void 0){o._p=p+n;break}}t.tags.sort((o,e)=>{const n=h(o),a=h(e);return n<a?-1:n>a?1:o._p-e._p})}}}),D={meta:"content",link:"href",htmlAttrs:"lang"},R=["innerHTML","textContent"],I=f(t=>({hooks:{"tags:resolve":s=>{var p;const{tags:o}=s;let e;for(let r=0;r<o.length;r+=1)o[r].tag==="templateParams"&&(e=s.tags.splice(r,1)[0].props,r-=1);const n=e||{},a=n.separator||"|";delete n.separator,n.pageTitle=u(n.pageTitle||((p=o.find(r=>r.tag==="title"))==null?void 0:p.textContent)||"",n,a);for(const r of o){if(r.processTemplateParams===!1)continue;const i=D[r.tag];if(i&&typeof r.props[i]=="string")r.props[i]=u(r.props[i],n,a);else if(r.processTemplateParams||r.tag==="titleTemplate"||r.tag==="title")for(const l of R)typeof r[l]=="string"&&(r[l]=u(r[l],n,a))}t._templateParams=n,t._separator=a},"tags:afterResolve":({tags:s})=>{let o;for(let e=0;e<s.length;e+=1){const n=s[e];n.tag==="title"&&n.processTemplateParams!==!1&&(o=n)}o!=null&&o.textContent&&(o.textContent=u(o.textContent,t._templateParams,t._separator))}}})),O=f({hooks:{"tags:resolve":t=>{const{tags:s}=t;let o,e;for(let n=0;n<s.length;n+=1){const a=s[n];a.tag==="title"?o=a:a.tag==="titleTemplate"&&(e=a)}if(e&&o){const n=y(e.textContent,o.textContent);n!==null?o.textContent=n||o.textContent:t.tags.splice(t.tags.indexOf(o),1)}else if(e){const n=y(e.textContent);n!==null&&(e.textContent=n,e.tag="title",e=void 0)}e&&t.tags.splice(t.tags.indexOf(e),1)}}}),K=f({hooks:{"tags:afterResolve":t=>{for(const s of t.tags)typeof s.innerHTML=="string"&&(s.innerHTML&&(s.props.type==="application/ld+json"||s.props.type==="application/json")?s.innerHTML=s.innerHTML.replace(/</g,"\\u003C"):s.innerHTML=s.innerHTML.replace(new RegExp(`</${s.tag}`,"g"),`<\\/${s.tag}`))}}});function V(t={}){const s=N(t);return s.use(T()),s}function k(t,s){return!t||t==="server"&&s||t==="client"&&!s}function N(t={}){const s=M();s.addHooks(t.hooks||{}),t.document=t.document||(_?document:void 0);const o=!t.document,e=()=>{r.dirty=!0,s.callHook("entries:updated",r)};let n=0,a=[];const p=[],r={plugins:p,dirty:!1,resolvedOptions:t,hooks:s,headEntries(){return a},use(i){const l=typeof i=="function"?i(r):i;(!l.key||!p.some(c=>c.key===l.key))&&(p.push(l),k(l.mode,o)&&s.addHooks(l.hooks||{}))},push(i,l){l==null||delete l.head;const c={_i:n++,input:i,...l};return k(c.mode,o)&&(a.push(c),e()),{dispose(){a=a.filter(g=>g._i!==c._i),e()},patch(g){for(const d of a)d._i===c._i&&(d.input=c.input=g);e()}}},async resolveTags(){const i={tags:[],entries:[...a]};await s.callHook("entries:resolve",i);for(const l of i.entries){const c=l.resolvedInput||l.input;if(l.resolvedInput=await(l.transform?l.transform(c):c),l.resolvedInput)for(const g of await b(l)){const d={tag:g,entry:l,resolvedOptions:r.resolvedOptions};await s.callHook("tag:normalise",d),i.tags.push(d.tag)}}return await s.callHook("tags:beforeResolve",i),await s.callHook("tags:resolve",i),await s.callHook("tags:afterResolve",i),i.tags},ssr:o};return[x,j,L,W,A,I,O,K,...(t==null?void 0:t.plugins)||[]].forEach(i=>r.use(i)),r.hooks.callHook("init",r),r}export{V as c};
