import{c as v}from"./hookable@5.5.1-f68282a5.js";import{m as P,P as b}from"./@unhead_dom@1.1.23-bcb21214.js";import{d as f,r as g,h as y,H as C,t as E,V as w,a as O,b as A,T as S,e as j}from"./@unhead_shared@1.1.23-886f2746.js";const h={critical:2,high:9,low:12,base:-1,title:1,meta:10};function m(r){if(typeof r.tagPriority=="number")return r.tagPriority;if(r.tag==="meta"){if(r.props.charset)return-2;if(r.props["http-equiv"]==="content-security-policy")return 0}const e=r.tagPriority||r.tag;return e in h?h[e]:10}const k=[{prefix:"before:",offset:-1},{prefix:"after:",offset:1}];function $(){return f({hooks:{"tags:resolve":r=>{const e=t=>{var s;return(s=r.tags.find(n=>n._d===t))==null?void 0:s._p};for(const{prefix:t,offset:s}of k)for(const n of r.tags.filter(o=>typeof o.tagPriority=="string"&&o.tagPriority.startsWith(t))){const o=e(n.tagPriority.replace(t,""));typeof o<"u"&&(n._p=o+s)}r.tags.sort((t,s)=>t._p-s._p).sort((t,s)=>m(t)-m(s))}}})}const I=()=>f({hooks:{"tags:resolve":r=>{const{tags:e}=r;let t=e.findIndex(n=>n.tag==="titleTemplate");const s=e.findIndex(n=>n.tag==="title");if(s!==-1&&t!==-1){const n=g(e[t].textContent,e[s].textContent);n!==null?e[s].textContent=n||e[s].textContent:delete e[s]}else if(t!==-1){const n=g(e[t].textContent);n!==null&&(e[t].textContent=n,e[t].tag="title",t=-1)}t!==-1&&delete e[t],r.tags=e.filter(Boolean)}}}),L=()=>f({hooks:{"tag:normalise":function({tag:r}){typeof r.props.body<"u"&&(r.tagPosition="bodyClose",delete r.props.body)}}}),T=typeof window<"u",M=()=>f({hooks:{"tag:normalise":r=>{var o,a;const{tag:e,entry:t,resolvedOptions:s}=r;s.experimentalHashHydration===!0&&(e._h=y(e));const n=typeof e.props._dynamic<"u";!C.includes(e.tag)||!e.key||T||(a=(o=J())==null?void 0:o.resolvedOptions)!=null&&a.document||(t._m==="server"||n)&&(e._h=e._h||y(e),e.props[`data-h-${e._h}`]="")},"tags:resolve":r=>{r.tags=r.tags.map(e=>(delete e.props._dynamic,e))}}}),_=["script","link","bodyAttrs"],W=()=>{const r=(e,t)=>{const s={},n={};Object.entries(t.props).forEach(([a,l])=>{a.startsWith("on")&&typeof l=="function"?n[a]=l:s[a]=l});let o;return e==="dom"&&t.tag==="script"&&typeof s.src=="string"&&typeof n.onload<"u"&&(o=s.src,delete s.src),{props:s,eventHandlers:n,delayedSrc:o}};return f({hooks:{"ssr:render":function(e){e.tags=e.tags.map(t=>(!_.includes(t.tag)||!Object.entries(t.props).find(([s,n])=>s.startsWith("on")&&typeof n=="function")||(t.props=r("ssr",t).props),t))},"dom:beforeRenderTag":function(e){if(!_.includes(e.tag.tag)||!Object.entries(e.tag.props).find(([o,a])=>o.startsWith("on")&&typeof a=="function"))return;const{props:t,eventHandlers:s,delayedSrc:n}=r("dom",e.tag);Object.keys(s).length&&(e.tag.props=t,e.tag._eventHandlers=s,e.tag._delayedSrc=n)},"dom:renderTag":function(e){const t=e.$el;if(!e.tag._eventHandlers||!t)return;const s=e.tag.tag==="bodyAttrs"&&typeof window<"u"?window:t;Object.entries(e.tag._eventHandlers).forEach(([n,o])=>{const a=`${e.tag._d||e.tag._p}:${n}`,l=n.slice(2).toLowerCase(),i=`data-h-${l}`;if(e.markSideEffect(a,()=>{}),t.hasAttribute(i))return;const d=o;t.setAttribute(i,""),s.addEventListener(l,d),e.entry&&(e.entry._sde[a]=()=>{s.removeEventListener(l,d),t.removeAttribute(i)})}),e.tag._delayedSrc&&t.setAttribute("src",e.tag._delayedSrc)}}})},D=["templateParams","htmlAttrs","bodyAttrs"],x=()=>f({hooks:{"tag:normalise":function({tag:r}){["hid","vmid","key"].forEach(t=>{r.props[t]&&(r.key=r.props[t],delete r.props[t])});const e=r.key?`${r.tag}:${r.key}`:E(r);e&&(r._d=e)},"tags:resolve":function(r){const e={};r.tags.forEach(s=>{const n=s._d||s._p,o=e[n];if(o){let a=s==null?void 0:s.tagDuplicateStrategy;if(!a&&D.includes(s.tag)&&(a="merge"),a==="merge"){const i=o.props;["class","style"].forEach(d=>{s.props[d]&&i[d]&&(d==="style"&&!i[d].endsWith(";")&&(i[d]+=";"),s.props[d]=`${i[d]} ${s.props[d]}`)}),e[n].props={...i,...s.props};return}else if(s._e===o._e){o._duped=o._duped||[],s._d=`${o._d}:${o._duped.length+1}`,o._duped.push(s);return}const l=Object.keys(s.props).length;if((l===0||l===1&&typeof s.props["data-h-key"]<"u")&&!s.innerHTML&&!s.textContent){delete e[n];return}}e[n]=s});const t=[];Object.values(e).forEach(s=>{const n=s._duped;delete s._duped,t.push(s),n&&t.push(...n)}),r.tags=t}}});function u(r,e){function t(o){let a="";return["s","pageTitle"].includes(o)?a=e.pageTitle:o.includes(".")&&(a=o.split(".").reduce((l,i)=>l[i]||"",e)),a||e[o]||""}let s=r;try{s=decodeURI(r)}catch{}return(s.match(/%(\w+\.+\w+)|%(\w+)/g)||[]).sort().reverse().forEach(o=>{r=r.replaceAll(o,t(o.slice(1))).trim()}),e.separator&&(r.endsWith(e.separator)&&(r=r.slice(0,-e.separator.length).trim()),r.startsWith(e.separator)&&(r=r.slice(e.separator.length).trim()),r=r.replace(new RegExp(`\\${e.separator}\\s*\\${e.separator}`,"g"),e.separator)),r}function K(){return f({hooks:{"tags:resolve":r=>{var o;const{tags:e}=r,t=(o=e.find(a=>a.tag==="title"))==null?void 0:o.textContent,s=e.findIndex(a=>a.tag==="templateParams"),n=s!==-1?e[s].textContent:{};n.pageTitle=n.pageTitle||t||"";for(const a of e)if(["titleTemplate","title"].includes(a.tag)&&typeof a.textContent=="string")a.textContent=u(a.textContent,n);else if(a.tag==="meta"&&typeof a.props.content=="string")a.props.content=u(a.props.content,n);else if(a.tag==="script"&&["application/json","application/ld+json"].includes(a.props.type)&&typeof a.innerHTML=="string")try{a.innerHTML=JSON.stringify(JSON.parse(a.innerHTML),(l,i)=>typeof i=="string"?u(i,n):i)}catch{}r.tags=e.filter(a=>a.tag!=="templateParams")}}})}let H;const B=r=>H=r,J=()=>H;async function R(r,e){const t={tag:r,props:{}};return["title","titleTemplate","templateParams"].includes(r)?(t.textContent=e instanceof Promise?await e:e,t):typeof e=="string"?["script","noscript","style"].includes(r)?(r==="script"&&(/^(https?:)?\/\//.test(e)||e.startsWith("/"))?t.props.src=e:(t.innerHTML=e,t.key=O(e)),t):!1:(t.props=await G(r,{...e}),t.props.children&&(t.props.innerHTML=t.props.children),delete t.props.children,Object.keys(t.props).filter(s=>A.includes(s)).forEach(s=>{(!["innerHTML","textContent"].includes(s)||S.includes(t.tag))&&(t[s]=t.props[s]),delete t.props[s]}),["innerHTML","textContent"].forEach(s=>{if(t.tag==="script"&&typeof t[s]=="string"&&["application/ld+json","application/json"].includes(t.props.type))try{t[s]=JSON.parse(t[s])}catch{t[s]=""}typeof t[s]=="object"&&(t[s]=JSON.stringify(t[s]))}),t.props.class&&(t.props.class=F(t.props.class)),t.props.content&&Array.isArray(t.props.content)?t.props.content.map(s=>({...t,props:{...t.props,content:s}})):t)}function F(r){return typeof r=="object"&&!Array.isArray(r)&&(r=Object.keys(r).filter(e=>r[e])),(Array.isArray(r)?r.join(" "):r).split(" ").filter(e=>e.trim()).filter(Boolean).join(" ")}async function G(r,e){for(const t of Object.keys(e)){const s=t.startsWith("data-");e[t]instanceof Promise&&(e[t]=await e[t]),String(e[t])==="true"?e[t]=s?"true":"":String(e[t])==="false"&&(s?e[t]="false":delete e[t])}return e}const U=10;async function V(r){const e=[];return Object.entries(r.resolvedInput).filter(([t,s])=>typeof s<"u"&&w.includes(t)).forEach(([t,s])=>{const n=j(s);e.push(...n.map(o=>R(t,o)).flat())}),(await Promise.all(e)).flat().filter(Boolean).map((t,s)=>(t._e=r._i,t._p=(r._i<<U)+s,t))}const N=()=>[x(),$(),K(),I(),M(),W(),L()],q=(r={})=>[b({document:r==null?void 0:r.document,delayFn:r==null?void 0:r.domDelayFn})];function Z(r={}){const e=Q({...r,plugins:[...q(r),...(r==null?void 0:r.plugins)||[]]});return r.experimentalHashHydration&&e.resolvedOptions.document&&(e._hash=P(e.resolvedOptions.document)),B(e),e}function Q(r={}){let e=[],t={},s=0;const n=v();r!=null&&r.hooks&&n.addHooks(r.hooks),r.plugins=[...N(),...(r==null?void 0:r.plugins)||[]],r.plugins.forEach(l=>l.hooks&&n.addHooks(l.hooks)),r.document=r.document||(T?document:void 0);const o=()=>n.callHook("entries:updated",a),a={resolvedOptions:r,headEntries(){return e},get hooks(){return n},use(l){l.hooks&&n.addHooks(l.hooks)},push(l,i){const d={_i:s++,input:l,_sde:{}};return i!=null&&i.mode&&(d._m=i==null?void 0:i.mode),i!=null&&i.transform&&(d._t=i==null?void 0:i.transform),e.push(d),o(),{dispose(){e=e.filter(c=>c._i!==d._i?!0:(t={...t,...c._sde||{}},c._sde={},o(),!1))},patch(c){e=e.map(p=>(p._i===d._i&&(d.input=p.input=c,o()),p))}}},async resolveTags(){const l={tags:[],entries:[...e]};await n.callHook("entries:resolve",l);for(const i of l.entries){const d=i._t||(c=>c);i.resolvedInput=d(i.resolvedInput||i.input);for(const c of await V(i)){const p={tag:c,entry:i,resolvedOptions:a.resolvedOptions};await n.callHook("tag:normalise",p),l.tags.push(p.tag)}}return await n.callHook("tags:resolve",l),l.tags},_popSideEffectQueue(){const l={...t};return t={},l},_elMap:{}};return a.hooks.callHook("init",a),a}export{Z as c,J as g};
